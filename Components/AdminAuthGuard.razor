@using Microsoft.AspNetCore.Components
@using Microsoft.JSInterop

@if (isAuthenticated)
{
    @ChildContent
}
else
{
    <div class="admin-auth-loading">
        <div class="loading-spinner"></div>
        <p>Проверка доступа...</p>
    </div>
}

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Inject] private IJSRuntime JS { get; set; } = default!;
    [Inject] private NavigationManager NavigationManager { get; set; } = default!;

    private bool isAuthenticated = false;

    protected override async Task OnInitializedAsync()
    {
        await CheckAuthentication();
    }

    private async Task CheckAuthentication()
    {
        try
        {
            var authStatus = await JS.InvokeAsync<string>("localStorage.getItem", "adminAuthenticated");
            isAuthenticated = authStatus == "true";
            
            if (!isAuthenticated)
            {
                NavigationManager.NavigateTo("/admin/login");
            }
        }
        catch
        {
            NavigationManager.NavigateTo("/admin/login");
        }
    }
}
